<!DOCTYPE html>
<html>
  <head>
    <title>Recursion Test</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <script type="text/javascript" src="../../../Element.js"></script>
    <script type="text/javascript" src="../../../UI.js"></script>
    <script type="text/javascript" src="../../../Knob.js"></script>
    <script type="text/javascript" src="../../../wrappers/CanvasDraw.js"></script>
  </head>
  <body>
    <canvas id="plugin" width="300" height="300"></canvas>
    <script type="text/javascript">

        // This should fix "console not defined" problem.
        if (typeof console=="undefined"){console={log:function(A){var B=false;if(B){alert(A)}}}}
        var ui;

        /* INIT */

        var plugin_canvas = document.getElementById("plugin");
        var plugin_context = plugin_canvas.getContext("2d");

        ui = new UI (plugin_canvas);

        var imageDisplayer = [] //new CanvasDrawImage (plugin_context);
        var MAX_KNOB_IMAGE_NUM = 60,
            knobImgLocation = "../../../../demos/voron/images/BigKnob/",
            knobImgArray = [],
            knobArgs = [],
            knob = [];

            // Shared arguments to the Knob constructor.
        (function () {
            for (var i = 0; i <= MAX_KNOB_IMAGE_NUM; i++) {
                var prefix = "";
                if (i < 10) {
                    prefix = "0";
                }
                knobImgArray[i] = knobImgLocation + "BigKnob" + prefix + i + ".png";
            }
        }());

        // KNOBS
        var NKNOBS = 3

        for (var i=0; i < NKNOBS; i+=1) {

            knobArgs[i] = {
                // onValueSet = undefined,
                images : knobImgArray,
                sensivity : 5000,
                onComplete: this.loadCallback,
                preserveBg: true
            };

            //onValueSet = undefined
            knob[i] = new Knob("knob" + i, [i*100 , 100], knobArgs[i]);
            imageDisplayer[i] = new CanvasDrawImage (plugin_context);

            knob[i].setValue("knobvalue", 0);
            ui.addElement(knob[i], imageDisplayer[i] , {zIndex: 10});
            
        }

        // Set the connections
        // 0 controls 1 and 1 controls 2. But when 2 "starts" the event, it
        // controls 0 (and thus 1), without entering in a feedback loop.

        // 0 -> 1
        ui.connectSlots("knob0", "knobvalue", "knob1", "knobvalue", {callback: function (value) {return 1-value;}});
        // 1 -> 0
        ui.connectSlots("knob1", "knobvalue", "knob0", "knobvalue", {callback: function (value) {return 1-value;}});
        // 1 -> 2
        ui.connectSlots("knob1", "knobvalue", "knob2", "knobvalue", {callback: function (value) {return value * 0.5;}});
        // 2 -> 0
        ui.connectSlots("knob2", "knobvalue", "knob0", "knobvalue", {callback: function (value) {return value;}});

    </script>
  </body>
</html>
